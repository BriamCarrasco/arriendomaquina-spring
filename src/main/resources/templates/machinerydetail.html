<!DOCTYPE html>
<html
  lang="es"
  xml:lang="es"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:th="https://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
  <head>
    <meta charset="UTF-8" />
    <title>Inicio | Arriendo de Maquinaria</title>
    <link rel="stylesheet" href="/style.css" />
    <meta name="_csrf" th:content="${_csrf.token}" />
    <meta name="_csrf_header" th:content="${_csrf.headerName}" />
    <meta
      property="og:title"
      th:content="${machinery.nameMachinery} + ' ‚Äî Arriendo de Maquinaria'"
      content="Nombre de la Maquinaria ‚Äî Arriendo de Maquinaria"
    />
    <meta
      property="og:description"
      th:content="${machinery.machineryInfo != null ? machinery.machineryInfo.description : 'Maquinaria disponible para arriendo.'}"
      content="Maquinaria disponible para arriendo."
    />
    <meta
      property="og:image"
      th:content="${machinery.imageUrl}"
      content="/default-image.jpg"
    />
    <meta
      property="og:url"
      th:content="${currentUrl}"
      content="https://tusitio.com/machinerydetail"
    />
  </head>
  <body>
    <nav class="navbar-app" aria-label="Navegaci√≥n principal">
      <h2 id="app-title">üåæ Arriendo de Maquinaria</h2>
      <div class="right">
        <span sec:authorize="isAuthenticated()" th:inline="text">
          Hola <span class="user-name" sec:authentication="name"></span> üëã
        </span>
        <form
          th:action="@{/logout}"
          method="post"
          sec:authorize="isAuthenticated()"
          class="logout-form"
        >
          <input
            type="hidden"
            th:name="${_csrf.parameterName}"
            th:value="${_csrf.token}"
          />
          <button type="submit" class="btn btn-outline">Cerrar sesi√≥n</button>
        </form>
        <a sec:authorize="isAnonymous()" th:href="@{/login}" class="btn"
          >Iniciar sesi√≥n</a
        >
      </div>
    </nav>

    <main class="container-app">
      <div th:if="${machinery != null}" class="machinery-detail">
        <h1 th:text="${machinery.nameMachinery}">Nombre de la Maquinaria</h1>

        <div class="machinery-detail-content">
          <div class="machinery-image">
            <img
              th:src="@{${machinery.imageUrl}}"
              th:alt="${machinery.nameMachinery}"
            />
          </div>

          <div class="machinery-text">
            <div class="machinery-info">
              <h2>Informaci√≥n General</h2>
              <p>
                <strong>Estado:</strong>
                <span th:text="${machinery.status}">Estado</span>
              </p>
              <p>
                <strong>Precio por d√≠a:</strong> $<span
                  th:text="${machinery.pricePerDay}"
                  >0.00</span
                >
              </p>
              <p>
                <strong>Categor√≠a:</strong>
                <span th:text="${machinery.category.name}">Categor√≠a</span>
              </p>

              <div th:if="${machinery.machineryInfo != null}">
                <h3>Descripci√≥n</h3>
                <p th:text="${machinery.machineryInfo.description}">
                  Descripci√≥n de la maquinaria
                </p>
              </div>
            </div>

            <div class="actions">
              <a
                th:href="@{/home}"
                class="btn"
                sec:authorize="isAuthenticated()"
                >Volver al inicio</a
              >
              <button class="btn btn-primary" sec:authorize="isAuthenticated()">
                Solicitar arriendo
              </button>

              <hr />

              <div
                class="social-share"
                aria-label="Compartir en redes sociales"
              >
                <span class="share-label">Compartir:</span>
                <button
                  type="button"
                  class="btn btn-outline"
                  data-share="facebook"
                  aria-label="Compartir en Facebook"
                >
                  Facebook
                </button>
                <button
                  type="button"
                  class="btn btn-outline"
                  data-share="twitter"
                  aria-label="Compartir en Twitter"
                >
                  Twitter
                </button>
                <button
                  type="button"
                  class="btn btn-outline"
                  data-share="whatsapp"
                  aria-label="Compartir en WhatsApp"
                >
                  WhatsApp
                </button>
              </div>
            </div>
          </div>
        </div>

        <section class="reviews-section">
          <h2>Rese√±as</h2>
          <div th:if="${averageRating != null}" class="average-rating">
            <strong>Promedio:</strong>
            <span th:text="${#numbers.formatDecimal(averageRating, 1, 1)}"
              >0.0</span
            >
            <span
              th:if="${averageRating > 0}"
              th:each="i : ${#numbers.sequence(1, T(java.lang.Math).round(averageRating))}"
              >‚≠ê</span
            >
          </div>
          <div
            th:if="${reviews != null and !reviews.isEmpty()}"
            class="reviews-list"
          >
            <div th:each="review : ${reviews}" class="review-item">
              <div class="review-header">
                <span class="review-user" th:text="${review.user.username}"
                  >Usuario</span
                >
                <span
                  class="review-rating"
                  th:each="i : ${#numbers.sequence(1, review.rating)}"
                  >‚≠ê</span
                >
                <span
                  class="review-date"
                  th:text="${#temporals.format(review.createdAt, 'dd/MM/yyyy')}"
                  >Fecha</span
                >
              </div>
              <p class="review-comment" th:text="${review.comment}">
                Comentario
              </p>
            </div>
          </div>
          <p th:if="${reviews == null or reviews.isEmpty()}" class="no-reviews">
            No hay rese√±as a√∫n.
          </p>

          <div sec:authorize="isAuthenticated()" class="add-review">
            <h3>Agregar Rese√±a</h3>
            <form id="reviewForm" th:data-machinery-id="${machinery.id}">
              <input type="hidden" name="id" th:value="${machinery.id}" />
              <div class="form-group">
                <label for="rating">Calificaci√≥n:</label>
                <select id="rating" name="rating" required>
                  <option value="1">‚≠ê 1</option>
                  <option value="2">‚≠ê‚≠ê 2</option>
                  <option value="3">‚≠ê‚≠ê‚≠ê 3</option>
                  <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê 4</option>
                  <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 5</option>
                </select>
              </div>
              <div class="form-group">
                <label for="comment">Comentario:</label>
                <textarea
                  id="comment"
                  name="comment"
                  rows="4"
                  required
                ></textarea>
              </div>
              <button type="submit" class="btn btn-primary">
                Enviar Rese√±a
              </button>
            </form>
          </div>
        </section>
      </div>

      <div th:if="${machinery == null}" class="error-message">
        <h2>Maquinaria no encontrada</h2>
        <p>No se pudo encontrar la maquinaria solicitada.</p>
        <a th:href="@{/home}" class="btn">Volver al inicio</a>
      </div>
    </main>
    <script src="/js/share.js" defer></script>
    <script src="/js/review.js" defer></script>
  </body>
</html>

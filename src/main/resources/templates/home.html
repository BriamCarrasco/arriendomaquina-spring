<!DOCTYPE html>
<html
  lang="es"
  xml:lang="es"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:th="https://www.thymeleaf.org"
>
  <head>
    <meta charset="UTF-8" />
    <title>Inicio | Arriendo de Maquinaria</title>
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>
    <nav class="navbar-app" aria-label="Navegaci贸n principal">
      <h2 id="app-title"> Arriendo de Maquinaria</h2>
      <div class="right">
        <span sec:authorize="isAuthenticated()" th:inline="text">
          Hola <span class="user-name" sec:authentication="name"></span> 
        </span>
        <form
          th:action="@{/logout}"
          method="post"
          sec:authorize="isAuthenticated()"
          style="display: inline"
        >
          <input
            type="hidden"
            th:name="${_csrf.parameterName}"
            th:value="${_csrf.token}"
          />
          <button type="submit" class="btn btn-outline">Cerrar sesi贸n</button>
        </form>
        <a sec:authorize="isAnonymous()" th:href="@{/login}" class="btn"
          >Iniciar sesi贸n</a
        >
      </div>
    </nav>

    <main class="container-app">
      <h1 id="bienvenida" th:text="|Bienvenido a ${name}!|">
        Bienvenido a la plataforma
      </h1>
      <h2 id="seguridad">Plataforma segura con Spring Security</h2>

      <!--  Contenido visible solo si est谩 autenticado -->
      <div sec:authorize="isAuthenticated()">
        <div class="section-title">
          <span class="badge badge-info">Inicio</span>
          <strong id="acciones-rapidas">Acciones r谩pidas</strong>
        </div>

        <div class="card-grid">
          <!-- Buscar maquinaria -->
          <div class="card">
            <h4 id="buscar-maquinaria">Buscar maquinaria</h4>
            <p>Explora equipos disponibles por nombre, categor铆a o estado.</p>
            <div class="actions">
              <a th:href="@{/search}" class="btn">Ir a b煤squeda</a>
            </div>
          </div>

          <!-- Publicar maquinaria -->
          <div class="card">
            <h4 id="publicar-maquinaria">Publicar maquinaria</h4>
            <p>
              Sube tus propios equipos para arriendo y gestiona su
              disponibilidad.
            </p>
            <div class="actions">
              <a
                th:href="@{/postmachinery}"
                class="btn"
                sec:authorize="hasAnyRole('OWNER','ADMIN')"
                >Publicar</a
              >
              <button
                class="btn btn-disabled"
                disabled
                sec:authorize="!hasAnyRole('OWNER','ADMIN')"
                aria-disabled="true"
              >
                Solo propietarios
              </button>
            </div>
          </div>

          <!-- Panel de administraci贸n -->
          <div class="card">
            <h4 id="panel-admin">Panel de administraci贸n</h4>
            <p>Gestiona usuarios, auditor铆as y estados de publicaci贸n.</p>
            <div class="actions">
              <a
                th:href="@{/adminpanel}"
                class="btn btn-outline"
                sec:authorize="hasRole('ADMIN')"
                >Abrir panel</a
              >
              <span class="badge badge-info" sec:authorize="!hasRole('ADMIN')"
                >Solo administradores</span
              >
            </div>
          </div>

          <!-- Resumen -->
          <div class="card">
            <h4 id="resumen">Resumen</h4>
            <p>Consulta el estado general de tus operaciones.</p>
            <div class="actions">
              <span class="badge badge-success">Activo</span>
            </div>
          </div>

          <!-- Reportes -->
          <div class="card">
            <h4 id="reportes">Reportes</h4>
            <p>Genera reportes operativos (pr贸ximamente).</p>
            <div class="actions">
              <button
                type="button"
                class="btn btn-outline"
                onclick="return false;"
                aria-disabled="true"
              >
                Ver ejemplo
              </button>
            </div>
          </div>
        </div>

        <!-- П Nueva secci贸n: listado de maquinarias -->
        <div class="section-title section-spacing">
          <span class="badge badge-info">Inventario</span>
          <strong id="maquinaria-disponible">Maquinaria disponible</strong>
        </div>

        <div th:if="${maquinarias != null and #lists.size(maquinarias) > 0}">
          <table class="table" border="1" aria-label="Listado de maquinarias">
            <thead>
              <tr>
                <th scope="col">ID</th>
                <th scope="col">Nombre</th>
                <th scope="col">Categor铆a</th>
                <th scope="col">Estado</th>
                <th scope="col">Precio d铆a</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="maq : ${maquinarias}">
                <td th:text="${maq.id}"></td>
                <td th:text="${maq.nameMachinery}"></td>
                <td
                  th:text="${maq.category != null ? maq.category.name : 'Sin categor铆a'}"
                ></td>
                <td th:text="${maq.status}"></td>
                <td
                  th:text="${#numbers.formatDecimal(maq.pricePerDay, 0, 'COMMA', 2, 'POINT')}"
                ></td>
              </tr>
            </tbody>
          </table>
        </div>

        <p th:if="${maquinarias == null or #lists.isEmpty(maquinarias)}">
          No hay maquinarias registradas actualmente.
        </p>
      </div>
      <!--  Invitaci贸n para usuarios an贸nimos -->
      <div sec:authorize="isAnonymous()">
        <div class="section-title">
          <span class="badge badge-info">Acceso</span>
          <strong id="zona-privada">Zona privada</strong>
        </div>
        <p>Inicia sesi贸n para acceder a las funciones de la plataforma.</p>
        <a th:href="@{/login}" class="btn">Iniciar sesi贸n</a>
      </div>
    </main>
  </body>
</html>

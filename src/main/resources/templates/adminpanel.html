<!DOCTYPE html>
<html
  lang="es"
  xml:lang="es"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:th="https://www.thymeleaf.org"
>
  <head>
    <meta charset="UTF-8" />
    <title>Inicio | Arriendo de Maquinaria</title>
    <link rel="stylesheet" href="/style.css" />
    <link rel="stylesheet" href="/bootstrap.min.css" />
  </head>
  <body>
    <nav class="navbar-app" aria-label="Navegaci贸n principal">
      <h2 id="app-title"> Arriendo de Maquinaria</h2>
      <div class="right">
        <span sec:authorize="isAuthenticated()" th:inline="text">
          Hola <span class="user-name" sec:authentication="name"></span> 
        </span>
        <form
          th:action="@{/logout}"
          method="post"
          sec:authorize="isAuthenticated()"
          style="display: inline"
        >
          <input
            type="hidden"
            th:name="${_csrf.parameterName}"
            th:value="${_csrf.token}"
          />
          <button type="submit" class="btn btn-outline">Cerrar sesi贸n</button>
        </form>
        <a sec:authorize="isAnonymous()" th:href="@{/login}" class="btn"
          >Iniciar sesi贸n</a
        >
      </div>
    </nav>

    <main class="container-app container">
      <h1 class="mb-4 section-title">Panel de Administraci贸n de Usuarios</h1>

      <!-- Formulario para crear usuario -->
      <div class="card mb-4">
        <div class="card-header bg-secondary text-white">Crear usuario</div>
        <div class="card-body">
          <form
            th:action="@{/api/admin/users/create}"
            method="post"
            class="row g-2"
          >
            <input
              type="hidden"
              th:name="${_csrf.parameterName}"
              th:value="${_csrf.token}"
            />
            <div class="col-md-3">
              <input
                type="text"
                name="username"
                class="form-control"
                placeholder="Usuario"
                required
              />
            </div>
            <div class="col-md-3">
              <input
                type="email"
                name="email"
                class="form-control"
                placeholder="Email"
                required
              />
            </div>
            <div class="col-md-3">
              <input
                type="password"
                name="password"
                class="form-control"
                placeholder="Contrase帽a"
                required
              />
            </div>
            <div class="col-md-3">
              <button type="submit" class="btn btn-success w-100">
                Crear usuario
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Tabla de usuarios -->
      <div class="card">
        <div class="card-header bg-secondary text-white">
          Usuarios registrados
        </div>
        <div class="card-body p-0">
          <table class="table table-striped table-hover mb-0">
            <thead class="table-dark">
              <tr>
                <th>ID</th>
                <th>Usuario</th>
                <th>Email</th>
                <th>Rol</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="user : ${users}">
                <td th:text="${user.id}"></td>
                <td th:text="${user.username}"></td>
                <td th:text="${user.email}"></td>
                <td th:text="${user.role}"></td>
                <td>
                  <a
                    th:href="@{/api/admin/users/edit/{id}(id=${user.id})}"
                    class="btn btn-warning btn-sm me-1"
                    >Editar</a
                  >
                  <form
                    th:action="@{/api/admin/users/delete}"
                    method="post"
                    class="d-inline"
                  >
                    <input
                      type="hidden"
                      th:name="${_csrf.parameterName}"
                      th:value="${_csrf.token}"
                    />
                    <input type="hidden" name="id" th:value="${user.id}" />
                    <button type="submit" class="btn btn-danger btn-sm">
                      Eliminar
                    </button>
                  </form>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </main>
    <script src="/bootstrap.bundle.min.js"></script>
  </body>
</html>
